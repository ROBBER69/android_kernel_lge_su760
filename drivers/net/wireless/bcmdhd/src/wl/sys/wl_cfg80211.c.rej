--- drivers/net/wireless/bcmdhd/src/wl/sys/wl_cfg80211.c	2012-12-31 06:33:44.000000000 +0900
+++ drivers/net/wireless/bcmdhd/src/wl/sys/wl_cfg80211.c	2012-11-23 18:12:32.000000000 +0900
@@ -440,10 +440,6 @@
 int dhd_start_xmit(struct sk_buff *skb, struct net_device *net);
 
 
-#ifdef BCMCCX
-/* to avoid disassoc after roaming by deauth frame from previous AP*/
-static char g_current_bssid[6] = {0, };
-#endif /* BCMCCX */
 #define CHECK_SYS_UP(wlpriv)						\
 do {									\
 	struct net_device *ndev = wl_to_prmry_ndev(wlpriv);       	\
@@ -600,13 +596,6 @@
 /* IOCtl version read from targeted driver */
 static int ioctl_version;
 
-/* LGE_CHANGE_S, moon-wifi@lge.com by 2lee, 20120619, When getting a station info just after freezing & Restarting tasks is failed, 
-tolerate it 10 times instead of force-disconneting. *///2LEE var.
-#define FAIL_LIMIT	2
-static int rssi_cnt = FAIL_LIMIT;
-/* LGE_CHANGE_E, moon-wifi@lge.com by 2lee, 20120619, When getting a station info just after freezing & Restarting tasks is failed, 
-tolerate it 10 times instead of force-disconneting. */
- 
 #ifdef D11AC_IOTYPES
 /* Return a new chanspec given a legacy chanspec
  * Returns INVCHANSPEC on error
@@ -2343,13 +2332,7 @@
 	WL_DBG(("pval (%d) gval (%d)\n", pval, gval));
 
 	if (is_wps_conn(sme)) {
-//LGE_CHANGE_S, moon-wifi@lge.com by wo0ngs 2012-06-23, WPS Support Both Open/WPA1,2
-		if (sme->privacy)
-			err = wldev_iovar_setint_bsscfg(dev, "wsec", 4, bssidx);
-		else
-			/* WPS-2.0 allowes no security */
-			err = wldev_iovar_setint_bsscfg(dev, "wsec", 0, bssidx);
-//LGE_CHANGE_E, moon-wifi@lge.com by wo0ngs 2012-06-23, WPS Support Open/WPA1,2 
+		err = wldev_iovar_setint_bsscfg(dev, "wsec", 4, bssidx);
 	} else {
 #ifdef BCMWAPI_WPI
 		if (sme->crypto.cipher_group == WLAN_CIPHER_SUITE_SMS4) {
@@ -2434,13 +2417,12 @@
 #endif
 					WPA2_AUTH_UNSPECIFIED)) {
 			switch (sme->crypto.akm_suites[0]) {
-			case WLAN_AKM_SUITE_8021X:
-				val = WPA2_AUTH_UNSPECIFIED;
+			case WLAN_AKM_SUITE_WAPI_CERT:
+				val = WAPI_AUTH_UNSPECIFIED;
 				break;
-			case WLAN_AKM_SUITE_PSK:
-				val = WPA2_AUTH_PSK;
+			case WLAN_AKM_SUITE_WAPI_PSK:
+				val = WAPI_AUTH_PSK;
 				break;
-
 #ifdef BCMCCX
 			case WLAN_AKM_SUITE_CCKM:
 				val = WPA2_AUTH_CCKM;
@@ -2452,23 +2434,7 @@
 				return -EINVAL;
 			}
 		}
-#if defined (BCMWAPI_WPI) 
-		else if (val & (WPA2_AUTH_PSK | WPA2_AUTH_UNSPECIFIED)) {
-			switch (sme->crypto.akm_suites[0]) {
-			case WLAN_AKM_SUITE_WAPI_CERT:
-				val = WAPI_AUTH_UNSPECIFIED;
-				break;
-			case WLAN_AKM_SUITE_WAPI_PSK:
-				val = WAPI_AUTH_PSK;
-				break;
-			default:
-				WL_ERR(("invalid cipher group (%d)\n",
-					sme->crypto.cipher_group));
-				return -EINVAL;
-			}
-		}
-#endif //BCMWAPI_WPI
-#endif   //2012-0801, add (BCMWAPI_WPI) || defined (BCMCCX)
+#endif
 		WL_DBG(("setting wpa_auth to %d\n", val));
 
 		err = wldev_iovar_setint_bsscfg(dev, "wpa_auth", val, bssidx);
@@ -3311,8 +3277,6 @@
 
 		/* Report the current tx rate */
 		err = wldev_ioctl(dev, WLC_GET_RATE, &rate, sizeof(rate), false);
-		WL_TRACE(("2LEE rate is %d \n", rate));
-		
 		if (err) {
 			WL_ERR(("Could not get rate (%d)\n", err));
 		} else {
@@ -3326,8 +3290,6 @@
 		scb_val.val = 0;
 		err = wldev_ioctl(dev, WLC_GET_RSSI, &scb_val,
 			sizeof(scb_val_t), false);
-		WL_TRACE(("2LEE rssi is  %d \n", scb_val.val));
-
 		if (err) {
 			WL_ERR(("Could not get rssi (%d)\n", err));
 			goto get_station_err;
@@ -3338,21 +3300,6 @@
 		WL_DBG(("RSSI %d dBm\n", rssi));
 
 get_station_err:
-		
-/* LGE_CHANGE_S, moon-wifi@lge.com by 2lee, 20120619, When getting a station info just after freezing & Restarting tasks is failed, 
-tolerate it 10 times instead of force-disconneting. */
-		if(err)
-		{
-			if(rssi_cnt-- > 0)
-			{
-				WL_ERR(("2LEE rssi_cnt is %d, and err is %d\n", rssi_cnt, err));
-				return err;
-			}
-		}
-		else rssi_cnt = FAIL_LIMIT;
-/* LGE_CHANGE_E, moon-wifi@lge.com by 2lee, 20120619, When getting a station info just after freezing & Restarting tasks is failed, 
-tolerate it 10 times instead of force-disconneting. */
-
 		if (err) {
 			/* Disconnect due to zero BSSID or error to get RSSI */
 			WL_ERR(("force cfg80211_disconnected\n"));
@@ -5044,19 +4991,6 @@
 	u32 event = ntoh32(e->event_type);
 	u16 flags = ntoh16(e->flags);
 
-#ifdef BCMCCX
-	if(event == WLC_E_DISASSOC_IND || event == WLC_E_DEAUTH_IND)
-	{
-	/* ignore deauth from previous AP after roaming */
-		if (memcmp(g_current_bssid, &e->addr, 6) != 0) {
-//			WL_ERROR(("Deauth[%d] from different BSSID\n", e->event_type));
-			WL_ERR(("Deauth[%d] from different BSSID\n", e->event_type));
-			return false;
-		} else {
-			bzero(g_current_bssid, ETHER_ADDR_LEN);
-		}
-	}
-#endif /* BCMCCX */
 	if (event == WLC_E_DEAUTH_IND ||
 	event == WLC_E_DISASSOC_IND ||
 	event == WLC_E_DISASSOC ||
@@ -5215,14 +5149,7 @@
 		goto exit;
 	isfree = true;
 
-//LGE_CHANGE_S, moon-wifi@lge.com by wo0ngs 2012-07-20, for Assoc, ReAssoc is processed in hostapd	
-#ifdef CONFIG_COMMON_PATCH
-	if (((event == WLC_E_ASSOC_IND) || (event == WLC_E_REASSOC_IND)) 
-		&& reason == DOT11_SC_SUCCESS){
-#else
 	if (event == WLC_E_ASSOC_IND && reason == DOT11_SC_SUCCESS) {
-#endif
-//LGE_CHANGE_E, moon-wifi@lge.com by wo0ngs 2012-07-20, for Assoc, ReAssoc is processed in hostapd	    
 		cfg80211_rx_mgmt(ndev, freq, mgmt_frame, len, GFP_ATOMIC);
 	} else if (event == WLC_E_DISASSOC_IND) {
 		cfg80211_rx_mgmt(ndev, freq, mgmt_frame, len, GFP_ATOMIC);
@@ -5278,10 +5205,6 @@
 			act = true;
 			wl_update_prof(wl, ndev, e, &act, WL_PROF_ACT);
 			wl_update_prof(wl, ndev, NULL, (void *)&e->addr, WL_PROF_BSSID);
-#ifdef BCMCCX
-			/* save current bssid */
-			memcpy(g_current_bssid, &e->addr, ETHER_ADDR_LEN);
-#endif /* BCMCCX */
 			if (wl_is_ibssmode(wl, ndev)) {
 				printk("cfg80211_ibss_joined\n");
 				cfg80211_ibss_joined(ndev, (s8 *)&e->addr,
@@ -5299,11 +5222,10 @@
 
 		} else if (wl_is_linkdown(wl, e)) {
 			if (wl->scan_request) {
-				del_timer_sync(&wl->scan_timeout);
 				if (wl->escan_on) {
 					wl_notify_escan_complete(wl, ndev, true, true);
 				} else {
-//					del_timer_sync(&wl->scan_timeout);
+					del_timer_sync(&wl->scan_timeout);
 					wl_iscan_aborted(wl);
 				}
 			}
@@ -5364,10 +5286,6 @@
 	u32 status = be32_to_cpu(e->status);
 	WL_DBG(("Enter \n"));
 	if (event == WLC_E_ROAM && status == WLC_E_STATUS_SUCCESS) {
-#ifdef BCMCCX
-		/* save current bssid */
-		memcpy(g_current_bssid, &e->addr, ETHER_ADDR_LEN);
-#endif /* BCMCCX */
 		if (wl_get_drv_status(wl, CONNECTED, ndev))
 			wl_bss_roaming_done(wl, ndev, e, data);
 		else
@@ -6196,15 +6114,7 @@
 	if (wl->scan_request) {
 		WL_ERR(("timer expired\n"));
 		if (wl->escan_on)
-//LGE_CHANGE_S, moon-wifi@lge.com by wo0ngs 2012-06-07, Prevent Kernel Panic due to scan abort noti. ioctl cmd in callback func.
-		{
-#ifdef CONFIG_COMMON_PATCH
-			wl_notify_escan_complete(wl, wl->escan_info.ndev, true, false);
-#else
 			wl_notify_escan_complete(wl, wl->escan_info.ndev, true, true);
-#endif
-		}
-//LGE_CHANGE_E, moon-wifi@lge.com by wo0ngs 2012-06-07, Prevent Kernel Panic due to scan abort noti. ioctl cmd in callback func.
 		else
 			wl_notify_iscan_complete(wl_to_iscan(wl), true);
 	}
@@ -6503,19 +6413,6 @@
 			mutex_unlock(&wl->usr_sync);
 		}
 	}
-// CSC_s sungchul.choi@lge.com Broadcom_Patch_2012_08_23
-#ifdef CONFIG_COMMON_PATCH
-        else if (status == WLC_E_STATUS_NEWSCAN)
-        {    
-                escan_result = (wl_escan_result_t *)data;
-                if (escan_result)
-                {    
-                        WL_ERR(("P:WLC_E_STATUS_NEWSCAN!!!!!!:scan_request[%p]", wl->scan_request));                        
-                        WL_ERR(("P:sync_id[%d]:bss_count[%d]", escan_result->sync_id, escan_result->bss_count));                 
-                }
-        }            
-#endif       
-// CSC_e sungchul.choi@lge.com Broadcom_Patch_2012_08_23
 	else {
 		WL_ERR(("unexpected Escan Event %d : abort\n", status));
 		wl->escan_info.escan_state = WL_ESCAN_STATE_IDLE;
@@ -7224,7 +7121,7 @@
 		return BCME_VERSION;
 	}
 	ioctl_version = val;
-	WL_TRACE(("WLC_GET_VERSION=%d\n", ioctl_version));
+	WL_ERR(("WLC_GET_VERSION=%d\n", ioctl_version));
 
 	mutex_lock(&wl->usr_sync);
 	wl_cfg80211_attach_post(wl_to_prmry_ndev(wl));
